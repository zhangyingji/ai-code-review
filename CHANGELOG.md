# 更新日志

## [v2.0.0] - 2025-11-19

### 新增

- **HTML 报告可折叠功能**：为提交人和文件区域添加展开/折叠功能，支持单个卡片折叠和批量操作
- **悬浮快速导航栏**：在页面右下角添加固定位置的悬浮导航按钮，包含展开/折叠所有提交人和文件的快捷操作
- **严重问题汇总区域**：添加独立的"严重问题汇总"展示区域，将所有严重问题以卡片网格形式展示，方便快速查看
- **问题按严重程度排序**：报告中的所有问题现在按严重程度排序（严重→主要→次要→建议）

### 优化

- **精简统计模块**：合并"关键指标概览"和"总体统计"，删除重复的统计信息，提升首屏清晰度
- **改进 HTML 报告布局**：
  - 仪表盘设计改为渐变背景，视觉更现代
  - 严重问题卡片采用响应式网格，支持多列自适应布局
  - 折叠功能支持平滑动画过渡（0.3s）
- **增强用户交互**：
  - 折叠图标添加悬停效果，提示可交互性
  - 按钮提供视觉反馈
  - 严重问题区域使用红色主题强调重要性
- **日志优化**：深度思考模式日志改为在初始化时打印一次，避免重复输出

### 修复

- **深度思考日志重复问题**：将"深度思考模式已启用"日志从 chat() 方法移至 __init__() 方法，仅在初始化时打印一次
- **API Key 处理**：确保 api_key 为可选参数，仅在非空时添加 Authorization 头，兼容无认证的本地服务
- **HTTPS 证书警告**：添加 urllib3 警告禁用和 requests verify=False，支持自签名证书

### 报告改进

**Markdown 报告：**
- 在"按提交人统计"和"文件评审详情"中显示问题所在的行号
- 严重问题优先显示，其他问题最多显示 10 个

**HTML 报告：**
- 交互式仪表盘展示关键指标（总问题数、各严重程度问题数、提交数等）
- 可折叠的提交人区域和文件区域，默认展开
- 悬浮导航按钮支持一键展开/折叠
- 严重问题卡片展示以下信息：
  - 提交人名称
  - 文件路径
  - 问题行号
  - 问题描述
  - 改进建议
- 所有问题按严重程度排序显示

### 技术栈保持

- Python 3.8+
- GitLab API
- OpenAI 兼容格式的大模型 API
- Jinja2 模板引擎
- ThreadPoolExecutor 并发处理

---

## [v1.0.0] - 2025-11-10

### 初始版本

- **核心功能**：
  - GitLab 集成，自动拉取代码差异
  - 大模型代码评审
  - 多格式报告生成（HTML/Markdown/JSON）
  - 按提交人分组统计

- **配置系统**：
  - YAML 配置文件
  - 支持本地配置覆盖（config.local.yaml）
  - 可配置的评审规则

- **性能优化**：
  - ThreadPoolExecutor 并发评审
  - 可配置的并发度（max_workers）

- **日志系统**：
  - 文件日志支持
  - 轮转日志处理
  - 多级别日志记录

- **深度思考模式**：
  - 支持通过消息标签（/think, /no_think）切换
  - 支持全局配置启用

- **分支管理**：
  - 支持指定源分支和基准分支
  - 基准分支为必输参数

---

## 版本规划

### 未来规划

- [ ] 评审规则模板库
- [ ] Web UI 界面
- [ ] 评审历史记录
- [ ] 自定义报告主题
- [ ] Webhook 集成自动触发评审
- [ ] 评审结果数据库存储
- [ ] 集成gerrit

---

## 贡献指南

在做出重要变更时，请：
1. 更新相关的代码文档和注释
2. 更新本 CHANGELOG.md 文件
3. 在提交说明中引用相关的版本号

